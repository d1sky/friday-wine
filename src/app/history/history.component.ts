import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { getResponsiveDefault, getSrcSet, isLocalAsset } from '../shared/image-helpers';

export interface HistoryEra {
  period: string;
  title: string;
  content: string;
  image: string;
  imageAlt: string;
  fallbackImage?: string;
  currentSrc?: string;
}

import { ResponsiveImageComponent } from '../shared/responsive-image/responsive-image.component';

@Component({
  selector: 'app-history',
  standalone: true,
  imports: [CommonModule, ResponsiveImageComponent],
  templateUrl: './history.component.html',
  styleUrls: ['./history.component.scss']
})
export class HistoryComponent implements OnInit {
  /** Хронология по эпохам: факты из археологии и исторических источников */
  eras: HistoryEra[] = [
    {
      period: 'ок. 6000–5800 гг. до н.э.',
      title: 'Первые следы виноградного вина: Закавказье',
      content:
        'Самые ранние на сегодня доказательства производства именно виноградного вина даёт химический анализ керамики из Грузии (Южный Кавказ), опубликованный в 2017 году в Proceedings of the National Academy of Sciences. В сосудах неолитических стоянок культуры Шулавери-Шому обнаружены остатки вина из винограда вида Vitis vinifera — того же, из которого делают почти всё вино в мире. Крупные сосуды использовались для брожения, выдержки и подачи. В Китае известны более ранние (ок. 7000 г. до н.э.) следы ферментированного напитка, но это была смесь риса, мёда, боярышника и дикого винограда, а не чисто виноградное вино.',
      image: 'assets/images/history-era-1.jpg',
      imageAlt: 'Древняя керамика и виноград, неолит Кавказа',
      fallbackImage: 'https://images.pexels.com/photos/3952047/pexels-photo-3952047.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: 'ок. 4100 г. до н.э.',
      title: 'Древнейшая известная винодельня: пещера Арени-1',
      content:
        'В 2007 году в пещере Арени-1 в Армении (область Вайоц-Дзор) армяно-ирландская экспедиция обнаружила полноценную винодельню эпохи позднего энеолита. Раскопки продолжались до 2010 года. Найдены давильня (чаша для раздавливания винограда с стоком в чаны), ёмкости для брожения, кувшины для хранения, семена винограда, остатки мезги и посуда со следами вина. Возраст объекта — около 4100–4000 гг. до н.э.; это как минимум на тысячу лет старше следующей по древности известной винодельни (на территории Западного берега реки Иордан). В той же пещере позже нашли и другие артефакты, в том числе древнейшую в мире кожаную обувь (3600–3500 гг. до н.э.), что говорит о стабильном микроклимате, сохранившем органику.',
      image: 'assets/images/history-era-2.jpg',
      imageAlt: 'Пещера, каменные чаны — древняя винодельня',
      fallbackImage: 'https://images.pexels.com/photos/2609220/pexels-photo-2609220.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: 'с ок. 2500 г. до н.э.',
      title: 'Древний Египет: первые письменные свидетельства',
      content:
        'Древние египтяне оставили первые дошедшие до нас описания виноделия: сбор винограда и употребление вина зафиксированы на глиняных табличках и в погребальных камерах знати. Вино было привилегией фараонов и жрецов; основная часть населения пила пиво, мёд и другие напитки. Египетские источники показывают, что виноград целенаправленно культивировали и перерабатывали в вино уже в III тысячелетии до н.э. Изображения лоз, давилен и сосудов с вином встречаются в гробницах и на папирусах.',
      image: 'assets/images/history-era-3.jpg',
      imageAlt: 'Древнеегипетский мотив: виноград и сосуды',
      fallbackImage: 'https://images.pexels.com/photos/2147960/pexels-photo-2147960.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: 'бронзовый век — античность',
      title: 'Древняя Греция: виноделие в центре культуры',
      content:
        'Виноградарство в Греции известно с позднего неолита и широко распространилось к бронзовому веку. Минойский Крит перенял приёмы виноделия у Египта через торговлю; затем эти знания унаследовала микенская Греция. Греки усовершенствовали агротехнику и технологии производства и через колонизацию и торговлю распространили виноделие в Италию, Францию, причерноморские регионы и другие земли. Вино стало неотъемлемой частью общества: мифология (Дионис), медицина, философия и симпосии — совместные пиры, где вино разбавляли водой в кратерах и пили из киликов — тесно с ним связаны.',
      image: 'assets/images/history-era-4.jpg',
      imageAlt: 'Античная Греция: виноградники и море',
      fallbackImage: 'https://images.pexels.com/photos/2961029/pexels-photo-2961029.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: 'античность',
      title: 'Древний Рим: масштаб и география',
      content:
        'Римляне завозили лозы и технологии из Греции и вывели производство вина на новый уровень. Они заложили виноградники в Галлии и в долинах Рейна, Мозеля и Дуная — во многих из этих регионов виноделие сохраняется по сей день. Римская империя создала разветвлённые торговые пути и стандарты качества, заложив основу будущих европейских винных регионов. Труды римских авторов (например, Колумеллы) систематизировали агротехнику и приёмы виноделия на столетия вперёд.',
      image: 'assets/images/history-era-5.jpg',
      imageAlt: 'Римские террасы и виноградники',
      fallbackImage: 'https://images.pexels.com/photos/3952047/pexels-photo-3952047.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: 'V–XV вв.',
      title: 'Средневековье: монастыри и Бургундия',
      content:
        'С распространением христианства вино стало необходимым для литургии (символ крови Христовой). Монастыри превратились в главных производителей вина. Устав бенедиктинцев (529 г.) предусматривал виноградники, давильни и погреба для самообеспечения общины. Цистерцианцы, основавшие в 1098 году аббатство Сито, заложили знаменитый виноградник Кло-де-Вужо и вели систематические наблюдения за участками и приёмами виноделия. Вино монастырей стало товаром и источником дохода; герцоги Бургундии способствовали его известности по всей Европе. Многие бургундские крю, заложенные монахами, существуют и сегодня.',
      image: 'assets/images/history-era-6.jpg',
      imageAlt: 'Средневековый монастырский погреб с бочками',
      fallbackImage: 'https://images.pexels.com/photos/2147960/pexels-photo-2147960.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: 'конец XV — XVIII вв.',
      title: 'Новый Свет: миссии и «миссионерский» виноград',
      content:
        'Виноградную лозу (Vitis vinifera) в Америку впервые привёз Христофор Колумб во время второго плавания (1493–1496), но на Карибах она не прижилась. В 1524 году Эрнан Кортес, правитель Новой Испании, предписал закладывать виноградники; испанские монахи (францисканцы и иезуиты) выращивали лозу для вина для мессы. Распространённый сорт получил название «миссионерский» (Mission); его потомки до сих пор культивируются в Америке под именами Криолья, Паис и др. К концу XVIII века францисканец Хуниперо Серра заложил первые виноградники в Калифорнии; виноделие развивалось и в Южной Америке.',
      image: 'assets/images/history-era-7.jpg',
      imageAlt: 'Миссионерская винодельня, старый каменный пресс',
      fallbackImage: 'https://images.pexels.com/photos/5377770/pexels-photo-5377770.jpeg?auto=compress&cs=tinysrgb&w=800'
    },
    {
      period: '1860-е — наши дни',
      title: 'Филлоксера и современная эпоха',
      content:
        'В 1863 году во Франции (Лангедок) впервые зафиксировали филлоксеру — тлю, завезённую с американскими лозами. К 1867 году началось массовое заражение; вредитель распространился по Испании, Италии, Германии, Австро-Венгрии и другим странам. Было уничтожено около двух третей европейских виноградников; во Франции пострадало порядка 40% площадей. Решение предложил американский энтомолог Чарльз В. Райли: прививать европейские сорта на устойчивые американские подвои (Vitis riparia, Vitis rupestris и др.). С конца XIX века такая прививка стала стандартом почти во всём мире. В XX–XXI веках вино стало глобальным продуктом при одновременном возврате интереса к терруару, органическому и биодинамическому виноделию.',
      image: 'assets/images/history-era-8.jpg',
      imageAlt: 'Современный виноградник и винодельня',
      fallbackImage: 'https://images.pexels.com/photos/3952049/pexels-photo-3952049.jpeg?auto=compress&cs=tinysrgb&w=800'
    }
  ];

  ngOnInit() {
    this.eras.forEach((e) => {
      e.currentSrc = getResponsiveDefault(e.image);
    });
  }

  getSrcSetForEra(era: HistoryEra): string {
    return isLocalAsset(era.currentSrc || era.image) ? getSrcSet(era.image) : '';
  }

  onImageError(era: HistoryEra): void {
    if (era.fallbackImage) {
      era.currentSrc = era.fallbackImage;
    }
  }
}

