import { CommonModule } from '@angular/common';
import { Component } from '@angular/core';

export interface ProductionStep {
  number: number;
  title: string;
  image: string;
  /** Запасной URL (например Pexels), если локальное изображение не загрузилось */
  fallbackImage?: string;
  imageAlt: string;
  description: string;
  details: string;
}

@Component({
  selector: 'app-production',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './production.component.html',
  styleUrls: ['./production.component.scss']
})
export class ProductionComponent {
  steps: ProductionStep[] = [
    {
      number: 1,
      title: 'Выбор места и закладка виноградника',
      image: 'assets/images/production-step-1.jpg',
      fallbackImage: 'https://images.pexels.com/photos/3952047/pexels-photo-3952047.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Виноградник на склоне холма',
      description: 'Успех будущего вина закладывается ещё до посадки первой лозы.',
      details: 'Винодел оценивает климат региона (температуры, осадки, количество солнечных дней), тип и состав почв, экспозицию склона и высоту над уровнем моря. Подбираются сорта винограда и подвои, устойчивые к местным болезням и засухе. Рассчитывается плотность посадки (от нескольких тысяч до более чем 10 000 лоз на гектар) и система ведения лозы (шпалера, гобле, пергола и др.). Закладка виноградника — инвестиция на десятилетия: первые полноценные урожаи часто получают только через 5–7 лет.'
    },
    {
      number: 2,
      title: 'Вегетация и уход за лозой',
      image: 'assets/images/production-step-2.jpg',
      fallbackImage: 'https://images.pexels.com/photos/3013467/pexels-photo-3013467.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Виноградная лоза с листьями и гроздьями',
      description: 'В течение года лоза проходит цикл: пробуждение, цветение, завязывание ягод, налив и созревание.',
      details: 'Зимняя и весенняя обрезка определяет нагрузку урожаем. Летние зелёные операции — подвязка побегов, удаление лишних листьев вокруг гроздей (для проветривания и доступа солнца), при необходимости зелёный сбор — помогают сконцентрировать аромат и сахар в оставшихся ягодах. Защита от милдью, оидиума и вредителей ведётся по принципам классической или органической агрономии. Цель всего цикла — здоровый, равномерно созревший виноград с балансом сахара, кислот и фенольной зрелости (для красных — зрелые танины в кожице и косточках).'
    },
    {
      number: 3,
      title: 'Сбор урожая',
      image: 'assets/images/production-step-3.jpg',
      fallbackImage: 'https://images.pexels.com/photos/5377770/pexels-photo-5377770.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Ручной сбор винограда в корзину',
      description: 'Момент сбора урожая — один из самых ответственных решений в виноделии.',
      details: 'Ручной сбор позволяет отбраковывать повреждённые грозди и сохранять целостность ягод; он незаменим на крутых склонах и при производстве премиальных и игристых вин. Механический сбор быстрее и дешевле, подходит для равнинных участков и больших объёмов. Важен выбор даты: слишком ранний сбор даёт вино с зелёными нотами и высокой кислотностью; слишком поздний — потерю свежести, перезрелые или изюмные тона. В прохладных регионах иногда ждут первых заморозков для производства ice wine; в других — собирают ночью, чтобы привезти в погреб холодный виноград.'
    },
    {
      number: 4,
      title: 'Дробление и прессование',
      image: 'assets/images/production-step-4.jpg',
      fallbackImage: 'https://images.pexels.com/photos/3952049/pexels-photo-3952049.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Виноградная мезга и сок на винодельне',
      description: 'Ягоды подготавливают к брожению: отделяют от гребней и аккуратно разрушают кожицу.',
      details: 'Дестаммизация (дежестеммаж) — удаление гребней — уменьшает горечь и жёсткость танинов. Затем ягоды раздавливают (дробление), получая сусло и мезгу. Для белых вин сок как можно быстрее отделяют от кожицы и твёрдых частиц (отстой, декантирование, прессование), чтобы сохранить свежесть и минимизировать контакт с танинами. Для красных вин мезгу оставляют вместе с соком на время брожения: красящие вещества и танины переходят из кожицы в вино. Прессование после брожения даёт прессовое вино, которое иногда добавляют к основному купажу для объёма и структуры.'
    },
    {
      number: 5,
      title: 'Алкогольное брожение',
      image: 'assets/images/production-step-5.jpg',
      fallbackImage: 'https://images.pexels.com/photos/5472630/pexels-photo-5472630.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Бродильные ёмкости на винодельне',
      description: 'Дрожжи превращают сахар сусла в спирт, углекислый газ и тепло; рождается вино.',
      details: 'Брожение может идти на диких дрожжах (с кожицы винограда) или на внесённых культивированных штаммах — последние дают предсказуемый результат. Температура критична: низкая (12–18 °C) типична для белых и розовых вин и сохраняет ароматику; высокая (25–32 °C) для красных усиливает экстракцию цвета и танинов. Длительность варьируется от одной до трёх недель и более. В красных винах часто практикуют перемешивание мезги (пижаж, ремонтаж) или погружение «шапки» в сок (дельстаж) для лучшей экстракции. По окончании брожения получают сухое вино (сахар переработан); при остановке брожения — полусухое или сладкое.'
    },
    {
      number: 6,
      title: 'Малолактическая ферментация',
      image: 'assets/images/production-step-6.jpg',
      fallbackImage: 'https://images.pexels.com/photos/2609220/pexels-photo-2609220.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Дубовые бочки в погребе',
      description: 'Яблочная кислота под действием бактерий превращается в более мягкую молочную.',
      details: 'МЛФ (яблочно-молочное брожение) снижает резкую кислотность и придаёт вину сливочные, маслянистые оттенки; иногда появляются лёгкие ореховые или «диацетиловые» ноты. Для большинства красных вин МЛФ желательна и часто проходит в бочках весной после основного брожения. Для белых — выборочно: в выдержанных Chardonnay и подобных стилях её проводят для округлости; в лёгких ароматных винах (Sauvignon Blanc, Riesling) обычно избегают, чтобы сохранить свежесть. Температура и отсутствие SO2 способствуют старту МЛФ; после завершения вино стабилизируют.'
    },
    {
      number: 7,
      title: 'Выдержка',
      image: 'assets/images/production-step-7.jpg',
      fallbackImage: 'https://images.pexels.com/photos/2147960/pexels-photo-2147960.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Выдержка вина в дубовых бочках',
      description: 'Вино «отдыхает» и развивается: в бочке, в танке или в бутылке.',
      details: 'Выдержка в нержавеющей стали или бетоне сохраняет чистый фруктовый профиль без влияния дуба. В дубовых бочках (новых или использованных, разного обжига и происхождения) вино получает ноты ванили, специй, шоколада, орехов; танины смягчаются, структура обогащается. Срок выдержки — от нескольких месяцев до нескольких лет в зависимости от стиля и амбиций винодела. Часть вин выдерживается в бутылке уже после розлива: в тихих условиях они медленно эволюционируют, развивая вторичные и третичные ароматы.'
    },
    {
      number: 8,
      title: 'Купажирование, фильтрация и розлив',
      image: 'assets/images/production-step-8.jpg',
      fallbackImage: 'https://images.pexels.com/photos/1557230/pexels-photo-1557230.jpeg?auto=compress&cs=tinysrgb&w=1200',
      imageAlt: 'Бутылки вина и пробки',
      description: 'Винодел создаёт финальный купаж, стабилизирует вино и разливает его по бутылкам.',
      details: 'Купажирование — смешивание разных партий, сортов или участков — позволяет достичь желаемого стиля, баланса и постоянства. Затем вино стабилизируют (например, от нежелательных осадков и повторного брожения), при необходимости фильтруют и разливают. Розлив может быть ручным (малые хозяйства) или на автоматических линиях. Пробка (натуральная, агломерированная или альтернативная) или винтовая крышка запечатывают бутылку. Многие вина готовы к употреблению сразу; премиальные красные и некоторые белые продолжают развиваться в бутылке годами.'
    }
  ];

  onImageError(step: ProductionStep): void {
    if (step.fallbackImage) {
      step.image = step.fallbackImage;
    }
  }
}

